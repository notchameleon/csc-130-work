package project2;
import java.util.Scanner;
import java.io.File;
import java.io.FileNotFoundException;
import java.util.Random;
/*
 * 
 * Main class for the PROJECT2 Program.
 * Handles usser input  , road intialization and simulation execution
 * 
 * @author Steff
 */

public class MainTrafficSimulation {
	private static final Random random = new Random();
	public static void main(String[] args) 
	{
		Scanner scnr = new Scanner(System.in);
		
		try 
		{	
		
		//Get road size from user
		int roadSize = getRoadSize(scnr);
		
		
		//Get number of vehicles from user
		int numVehicles = getNumberOfVehicles(scnr, roadSize);
		
		//Create road and initalize with random vehicles
		Road road = initializeRoadWithRandomVehicles(roadSize, numVehicles);
		
		
		System.out.println("\n--- INITIAL TRAFFFIC LANE ---");
		road.displayRoad();
		
		
		Road.processCommandsFromFile(road, "testInput.txt");
		
		
		System.out.println("\n--- Simulation Complete ---");
		
		} catch (FileNotFoundException e) {
			System.out.println("Error: Input file 'testInput'.txt' not found!");
		} catch (Exception e) {
			System.out.println("An error occured: " + e.getMessage());
		} finally {
			scnr.close();
		}
	
	}
	/*
	 * getRoadSize(Scanner scnr) - int
	 *  Get road size from user with validation
	 *  @param scnr the Scanner object for user input
	 *  @return validate road size(minimum 5)
	 */
	
	private static int getRoadSize(Scanner scnr) 
	{
		int size = 0;
		while (size < 5)
		{
			System.out.print("Enter road size (minimum 5); ");
			if (scnr.hasNextInt())
			{
				size = scnr.nextInt();
				if (size < 5) 
				{
					System.out.println("Road size must be at least 5. Please try again");
				}
			} else {
				System.out.println("Invalid input. Please enter a number.");
				scnr.next();
				}
			}
		return size;
		}
	
	/*
	 * getNumberOfVehicles() - int
	 * Get number of vehicles from user with validation
	 * @param scnr The scanner object for user input of amount of vehicles
	 * @param roadSize the size of the road for calculating maximum vehicles
	 * @return valid number of vehicles
	 */
	
	private static int getNumberOfVehicles(Scanner scnr, int roadSize)
	{
		int numVehicles = 0;
		int maxVehicles = roadSize - 2; 
		
		while (numVehicles < 1 || numVehicles > maxVehicles)
		{
			System.out.print("Enter number of vehicles (1 to " + maxVehicles + "); ");
			if (scnr.hasNextInt())
			{
				numVehicles = scnr.nextInt();
				if (numVehicles < 1)
				{
					System.out.println("Must have at least 1 vehicle.");
				} else if (numVehicles > maxVehicles) 
				{
					System.out.println("Too many vehicles for road size. Maximum is " + maxVehicles + ".");
				}
			} else {
				System.out.println("Invalid input. Please enter a number.");
				scnr.next();
				}
			}
		return numVehicles;
		}
	
	/*
	 * initalizeRoadWithRandomVehicles(int roadSize,  int numVehicles) - Road
	 * @param roadSize - the size of the road to create 
	 * @param numVehicles the number of vehicles to place
	 * @return a Road Object populated with random vehicles
	 * 
	 */
	
	private static Road initializeRoadWithRandomVehicles(int roadSize, int numVehicles)
	{
		Road road = new Road(roadSize);
		
		boolean[] occupied = new boolean[roadSize];
		int vehiclesPlaced = 0;
		
		while (vehiclesPlaced < numVehicles) 
		{
			int randomPosition = random.nextInt(roadSize);
			
			// Only place vehicle if position if is empty
			
			if (!occupied[randomPosition])
			{
				Vehicle vehicle = createRandomVehicle();
				if (road.placeVehicle(randomPosition, vehicle))
				{
					occupied[randomPosition] = true;
					vehiclesPlaced++;
					System.out.println("Placed " + vehicle + " at position " + randomPosition);
				}
			}
		}
	
		return road;
	}
	
	
	/*
	 * createRandomVehicle() - Vehicle
	 * @return a randomy generate Vehicle object
	 */

	
	private static Vehicle createRandomVehicle()
	{
		if (random.nextBoolean())
		{
			String[] colors = {"red", "blue", "green", "yellow", "black", "white"};
			String color = colors[random.nextInt(colors.length)];
			
			int horsepower = 80 + random.nextInt(171);
			return new Car(color , horsepower);
		} else {
			//Create random Bus
			
			int weight = 3000 + random.nextInt(7001);
			int horsepower = 150 + random.nextInt(201);
			return new Bus(weight , horsepower);
		}
	}
	
	public static int[] readMovementsFromFile(String fileName) throws FileNotFoundException {
		
		
		Scanner scanValues = new Scanner ( new File(fileName));
		
		
		//Count how many values
		int count = 0;
		while (scanValues.hasNextInt())
		{
			scanValues.nextInt();
			count++;
		}
		
		scanValues.close();
		
		
		//Read values
		scanValues = new Scanner(new File(fileName));
		int[] movements = new int[count];
		for (int i = 0; i < count; i++)
		{
			movements[i] = scanValues.nextInt();
		}
		
		scanValues.close();
		return movements;
		
	}
	
	
	public static String getDirectionName(int direction) 
	{
		if (direction == 1) return "FORWARD";
		if (direction == 0) return "STAY";
		if (direction == -1) return "BACKWARD";
		return "UNKNOWN";
	}
	
	
	

}
